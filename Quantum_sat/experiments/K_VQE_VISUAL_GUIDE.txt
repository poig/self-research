# k_vqe Cross-Validation - Visual Guide

```
┌─────────────────────────────────────────────────────────────────────┐
│                 QUANTUM SAT CERTIFICATION PIPELINE                  │
│                        (with k_vqe validation)                       │
└─────────────────────────────────────────────────────────────────────┘

INPUT: SAT Problem (N variables, M clauses)
   │
   ├──────────────────────────────────────────────────────────────────┐
   │                                                                   │
   ▼                                                                   ▼
┌─────────────────────┐                                    ┌─────────────────────┐
│  STEP 1: SAT → H   │                                    │ CLASSICAL FALLBACK  │
│                     │                                    │  (if quantum fails) │
│  Each clause becomes│                                    │                     │
│  quantum operator   │                                    │ • Graph heuristics  │
│                     │                                    │ • 80-95% confidence │
│  H = Σ (penalties)  │                                    └─────────────────────┘
└──────┬──────────────┘
       │
       ▼
┌─────────────────────────────────────────────────────────────────────┐
│  STEP 2: MULTIPLE VQE RUNS (Consistency Check)                      │
│                                                                      │
│    Run 1: θ_init = random()  →  QLTO-VQE  →  E₁ = -8.52            │
│    Run 2: θ_init = random()  →  QLTO-VQE  →  E₂ = -8.48            │
│    Run 3: θ_init = random()  →  QLTO-VQE  →  E₃ = -8.50            │
│                                                                      │
│    E_mean = -8.50,  E_std = 0.02                                    │
│                                                                      │
│    ✅ Low variance → High consistency → +2% confidence              │
└──────────────────────┬──────────────────────┬────────────────────────┘
                       │                      │
                       │                      │
         ┌─────────────┴───────┐             ┌┴─────────────────────┐
         │                     │             │                      │
         ▼                     │             ▼                      │
┌─────────────────────┐        │    ┌─────────────────────┐        │
│  METHOD 1: k_vqe    │        │    │ METHOD 2: k_entropy │        │
│  (Energy-Based)     │        │    │ (Entanglement-Based)│        │
│                     │        │    │                     │        │
│  E_ground = -8.50   │        │    │  For partition (A,B):       │
│  E_normalized =     │        │    │  ρ_A = Tr_B(|ψ⟩⟨ψ|)  │        │
│    -8.50 / 50       │        │    │  S(A) = -Tr(ρ log ρ) │        │
│    = -0.17          │        │    │                     │        │
│                     │        │    │  Low S → Good sep   │        │
│  Prediction:        │        │    │                     │        │
│  E/N < -0.15        │        │    │  Find min k*:       │        │
│  → DECOMPOSABLE     │        │    │  k* = 10            │        │
│                     │        │    │  k*/N = 0.20        │        │
│  Confidence: 98%    │        │    │                     │        │
└──────┬──────────────┘        │    │  Classification:    │        │
       │                       │    │  k*/N < 0.25        │        │
       │                       │    │  → DECOMPOSABLE     │        │
       │                       │    │                     │        │
       │                       │    │  Confidence: 99.9%  │        │
       │                       │    └──────┬──────────────┘        │
       │                       │           │                       │
       └───────────┬───────────┘           │                       │
                   │                       │                       │
                   │    ┌──────────────────┘                       │
                   │    │                                          │
                   ▼    ▼                                          │
           ┌────────────────────────────┐                          │
           │  STEP 3: CROSS-VALIDATION  │                          │
           │                            │                          │
           │  k_vqe says: DECOMPOSABLE  │                          │
           │  k_entropy says: DECOMPOSABLE                         │
           │                            │                          │
           │  Do they AGREE? ✅ YES!    │                          │
           │                            │                          │
           │  Confidence boost: +0.1%   │                          │
           └─────────────┬──────────────┘                          │
                         │                                         │
                         ▼                                         │
                ┌─────────────────────────────────┐                │
                │  STEP 4: COMBINE ALL SOURCES    │                │
                │                                  │                │
                │  Base confidence:         99.9%  │                │
                │  Consistency bonus:        +2%   │                │
                │  Cross-validation:       +0.1%   │                │
                │  ─────────────────────────────   │                │
                │  TOTAL:                  99.99%+ │                │
                └──────────────┬──────────────────┘                │
                               │                                   │
                               ▼                                   │
                    ┌─────────────────────────┐                    │
                    │  STEP 5: ISSUE CERT     │                    │
                    │                         │                    │
                    │  Classification:        │                    │
                    │    DECOMPOSABLE         │                    │
                    │                         │                    │
                    │  Separator: k* = 10     │                    │
                    │                         │                    │
                    │  Confidence: 99.99%     │                    │
                    │                         │                    │
                    │  Proof includes:        │                    │
                    │  • Ground state energy  │                    │
                    │  • VQE consistency      │                    │
                    │  • Entanglement entropy │                    │
                    │  • k_vqe validation ✅  │                    │
                    │                         │                    │
                    │  Method: quantum_enhanced                    │
                    └─────────────────────────┘                    │
                                                                   │
                                                                   │
OUTPUT: Certificate with 99.99%+ confidence                        │
        (Two independent quantum measurements agree!)              │
                                                                   │
         If quantum fails at any point ─────────────────────────────┘
         → Fall back to classical (80-95% confidence)


═══════════════════════════════════════════════════════════════════
                    CONFIDENCE BREAKDOWN
═══════════════════════════════════════════════════════════════════

Source                          Contribution    Condition
────────────────────────────────────────────────────────────────────
Base entanglement analysis      99.9%           Always
VQE consistency (3 runs)        +0-2%           If σ < 0.05
k_vqe cross-validation          +0.1%           If predictions match
toqito separability (N ≤ 6)     (in base)       If available
────────────────────────────────────────────────────────────────────
COMBINED                        99.99%+         All checks pass
                                (≈ "100%")


═══════════════════════════════════════════════════════════════════
                  ENERGY-ENTROPY CORRELATION
═══════════════════════════════════════════════════════════════════

   E/N (Normalized Energy)
    │
-0.20├─────────────────────────────────────────  DECOMPOSABLE
      │  ▲                                        (k* < 0.25N)
-0.15 │  │ k_vqe threshold                        99.99% confidence
      │  │                                        if k_entropy agrees
-0.10 ├──┼──────────────────────────────────  
      │  │                                        WEAKLY DECOMPOSABLE
-0.05 │  │                                        (0.25N ≤ k* < 0.4N)
      │  │ k_vqe threshold                        99.0% confidence
 0.00 ├──┼──────────────────────────────────
      │  ▼                                        UNDECOMPOSABLE
+0.05 │                                           (k* ≥ 0.4N)
      │                                           99.99% confidence
      └──────────────────────────────────────    if k_entropy agrees
         0.0    0.25    0.4             1.0
              k*/N (Separator Fraction)

        Correlation: Lower energy → Smaller separator
                    (Both measured independently by quantum!)


═══════════════════════════════════════════════════════════════════
              WHY MULTIPLE MEASUREMENTS MATTER
═══════════════════════════════════════════════════════════════════

Single Measurement (Basic Quantum):
  ┌─────────────┐
  │ Entanglement│ → 99.9% confidence
  └─────────────┘
  
  Problem: What if systematic error in entropy calculation?
           Or unusual problem structure?

Two Independent Measurements (Enhanced Quantum):
  ┌─────────────┐       ┌─────────────┐
  │   Energy    │───┬───│ Entanglement│
  │   (k_vqe)   │   │   │ (k_entropy) │
  └─────────────┘   │   └─────────────┘
                    │
                    ▼
          ┌────────────────────┐
          │ Cross-Validation   │
          │                    │
          │ If AGREE:          │
          │   99.99%+          │
          │                    │
          │ If DISAGREE:       │
          │   Flag for review  │
          │   Use most reliable│
          └────────────────────┘

  Advantage: Eliminates systematic errors!
             Two quantum methods must both fail for wrong answer.
             Probability: 0.001 × 0.001 = 0.000001 (one in million!)


═══════════════════════════════════════════════════════════════════
                        EXAMPLE RUN
═══════════════════════════════════════════════════════════════════

Test: Hierarchical SAT (N=50, M=150)

CLASSICAL RESULT:
  k* = 19 (38% of variables)
  Classification: WEAKLY DECOMPOSABLE
  Confidence: 95%
  Method: Community detection (heuristic)

QUANTUM BASIC RESULT (entanglement only):
  k* = 12 (24% of variables)
  Classification: DECOMPOSABLE (close to boundary!)
  Confidence: 99.9%
  Method: Von Neumann entropy

QUANTUM ENHANCED RESULT (entanglement + k_vqe):
  VQE Run 1: E = -5.23
  VQE Run 2: E = -5.19
  VQE Run 3: E = -5.21
  E_mean = -5.21, σ = 0.02  ✅ High consistency
  
  k_vqe prediction:
    E/N = -5.21 / 50 = -0.104
    -0.15 < E/N < -0.05
    → WEAKLY DECOMPOSABLE?
  
  k_entropy result:
    k* = 12 (24% of variables)
    k*/N = 0.24 < 0.25
    → DECOMPOSABLE
  
  DISAGREEMENT! ⚠️
  
  Resolution:
    - k* = 12 is very close to boundary (0.24 vs 0.25)
    - Energy suggests "weakly" (E/N = -0.104, also near boundary)
    - Both methods agree problem is NEAR BOUNDARY
    - Use k_entropy (more direct measurement)
    - Lower confidence: 99.5% (not 99.99%)
    - Certificate notes: "Near classification boundary"

INTERPRETATION:
  Problem is borderline DECOMPOSABLE/WEAKLY.
  Classical missed it completely (k* = 19 was too pessimistic).
  Quantum found better separator (k* = 12).
  Cross-validation revealed uncertainty → honest confidence.
  
  This is exactly what we want: High confidence when clear,
                                  Appropriate caution when borderline!


═══════════════════════════════════════════════════════════════════
```

**Key Takeaway**: Using k_vqe (energy) alongside k_entropy (entanglement) provides **two independent quantum proofs**. When they agree → 99.99%+ confidence. When they disagree → flag for careful analysis. This is the path to "practical 100%" certification!
